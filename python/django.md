# Django

## vim

如何用`idea`的`IdeaVim`插件的替换功能实现以下功能:

将`"../js/abc.js"`替换为`"/static/js/abc.js"`: `:%s/\.\.\/js\/\(.\{-}\)"\@=/static/\1/g`

解释如下:
* `vim`的正则元字符, 除了`^$.*`之外, 都需要`\\`转义, 包括`()+?{}`
* 因为替换`:s/old/new/g`使用了`/`字符, 所以`/`也需要转义
* `\{-}`表示匹配0或多, 懒惰匹配
* `\@=`表示前面的字符`"`有, 但不被匹配
* `\1`表示反向引用捕获组1

将`"../js/abc.js"`替换为`"{% static 'js/abc.js' %}"`: `:%s/\.\.\/\(js.\{-}\)"\@=/{% static '\1' %}/g`

将`"/static/xx/xx.xx"`替换为`"{% static 'xx/xx.xx' %}"`: `:%s/\/static\/\(.\{-}\)"\@=/{% static '\1' %}/g`

## 关于迁移

一次把所有的`migrations`文件都删除了, 把相应的数据表也删除了, 把`django_migrations`中的相应记录也删除了, 把`auth_permission`相应的表的权限记录也删除了, 然而还是提示我找不到缺失`migrations`文件的依赖. 真的太邪门了, 什么鬼, 难不成你还在操作系统层次上注册了什么小秘密. 最后的发现, 这不是`django`的锅, 是`python`的锅, 默认`python`会将文件编译成`.pyc`文件, 并使用此文件运行程序, 而`.pyc`并不会跟踪变化的. 所以, 最后把`.pyc`全删除掉后, 世界重新变得美好.