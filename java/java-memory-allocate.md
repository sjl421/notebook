# java memory

Java的数据类型主要分两类:原始数据类型和类.

## 原始数据类型

Java原始数据类型的内存分配大小依实现不同而不同,

`boolean`和`byte`占用1字节,`char`占用2字节,`int`和`float`占用4字节,`long`和`double`占用8字节

## 类的实例对象

一个对象占用的内存包括其所有实例变量占用的内存和对象本身的开销(一般为16字节)相加.

对象本身开销包括一个指向对象的类的引用,垃圾收集信息,以及同步信息.

一般内存的使用都会被填充为8字节的位数(64位机器上).

对象占用的内存和对象的引用(即变量名)占用的内存是两个概念.对象的引用一般都是一个内存地址,会占用8字节(同样是64位机器).

嵌套的非静态类(内部类)需要额外的8字节,用于指向外部类的引用.

## 数组

Java中的数组(无论原始数据类型数组或类对象数组)被实现为对象.

一个原始数据类型的数组一般需要24字节的头信息(16字节的对象开销,4字节用于保存长度以及4填充字节)再加上保存值所需的内存.

一个对象的数组是一个对象的引用的数组,即内存量为`24+8N`.若加上引用的对象的内存量`M`,则为`24+(8+M)N`.

二维数组是一个数组的数组,即每个数组都是一个对象.一个`MxN`的二维数组,内存量为`24+M*(8+24+KN)`,其中`K`是数组元素的内存,可为原始类型或对象.

## 字符串

字符串作为对象,除了16字节的对象开销外,标准实现含有4个实例变量:一个指向字符数组的引用(8字节),三个int值(分别保存字符数组的偏移量,字符串长度,散列值).包括4字节的填充,总共40字节.

一个长度为N的String对象一般需要使用40字节(String对象本身)加上`24+2N`字节(字符数组是对象,24字节的开销和每个字符`char`2字节).

任意字符串的子串只是对偏移量和字符串长度的更改,也就是说只使用40字节.String对象的char数组常常是在多个字符串间共享,String对象不可变.
